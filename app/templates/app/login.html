{% extends 'app/layout/basic.html' %}
{% load static %}

{% block title %}用户登录{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{% static 'app/css/account.css' %}">
    <style>
        .error-msg {
            color: red;
            font-size: 12px;
            position: absolute;
            left: 0;
            bottom: -2px;
        }
        .form-group {
            position: relative;
            padding-bottom: 20px;
            margin-bottom: 0;
        }
        #imageCode {
            cursor: pointer;
            height: 34px;
            width: 100%;
            object-fit: cover;
            border-radius: 4px;
        }
        .login-links {
            text-align: right;
            margin-bottom: 15px;
        }
    </style>
{% endblock %}

{% block content %}
<div class="account">
    <h2 class="title">用户登录</h2>
    <form id="loginForm" method="post" novalidate>
        {% csrf_token %}

        {% for field in form %}
            <div class="form-group">
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>

                {% if field.name == 'code' %}
                    <div class="row">
                        <div class="col-xs-7">
                            {{ field }}
                        </div>
                        <div class="col-xs-5">
                            <img src="{% url 'image_code' %}" alt="图片验证码" id="imageCode" title="点击刷新">
                        </div>
                    </div>
                {% else %}
                    {{ field }}
                {% endif %}

                <span class="error-msg">{{ field.errors.0 }}</span>
            </div>
        {% endfor %}

        <div class="login-links">
            <a href="{% url 'login_sms' %}">短信验证码登录?</a>
        </div>

        <button id="btnSubmit" type="submit" class="btn btn-primary btn-block">登 录</button>
    </form>
</div>
{% endblock %}

{% block js %}
<script>
$(document).ready(function () {
    $('#imageCode').click(function () {
        let currentSrc = $(this).attr('src').split('?')[0];
        $(this).attr('src', currentSrc + '?' + new Date().getTime());
    });
});
</script>
{% endblock %}
